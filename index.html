<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Humberside Scouts – Safety Audit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #b91c1c;
      --success: #166534;
      --radius-card: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 55%, #020617 100%);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 1.5rem;
    }

    .container {
      width: 100%;
      max-width: 960px;
      background: radial-gradient(circle at top left, #eff6ff 0, #ffffff 55%);
      border-radius: 18px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.35),
        0 0 0 1px rgba(148, 163, 184, 0.2);
      padding: 1.75rem 2rem 2.25rem;
    }

    @media (max-width: 720px) {
      .container {
        padding: 1.2rem 1.2rem 1.75rem;
        border-radius: 12px;
      }
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-bottom: 1.3rem;
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.75rem;
      color: var(--accent);
      font-weight: 600;
    }

    h1 {
      margin: 0;
      font-size: 1.7rem;
      color: #020617;
    }

    .subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
      max-width: 640px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    .tag {
      font-size: 0.75rem;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.08);
      color: #1e40af;
      border: 1px solid rgba(191, 219, 254, 0.8);
    }

    .note {
      font-size: 0.85rem;
      color: var(--text-muted);
      background: var(--accent-soft);
      border-left: 4px solid var(--accent);
      padding: 0.7rem 0.9rem;
      border-radius: 7px;
      margin-bottom: 1rem;
    }

    .note strong {
      color: #1e3a8a;
    }

    form {
      margin-top: 0.75rem;
    }

    .section-card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: var(--radius-card);
      border: 1px solid var(--border);
      padding: 1.1rem 1.25rem 1.2rem;
      margin-bottom: 1rem;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .section-title {
      font-size: 1.02rem;
      font-weight: 600;
      color: #111827;
    }

    .section-pill {
      font-size: 0.75rem;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: #4b5563;
      white-space: nowrap;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem 1.25rem;
    }

    @media (max-width: 720px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 0.9rem;
      color: #111827;
    }

    input[type="text"],
    input[type="email"],
    select,
    input[type="date"],
    textarea {
      width: 100%;
      margin-top: 0.25rem;
      padding: 0.5rem 0.55rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font: inherit;
      color: #111827;
      background-color: #ffffff;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid var(--accent-soft);
      border-color: var(--accent);
    }

    .required {
      color: #b91c1c;
      margin-left: 0.12rem;
    }

    .question {
      padding: 0.55rem 0.55rem 0.7rem;
      border-radius: 8px;
      border: 1px solid transparent;
      margin-bottom: 0.35rem;
    }

    .question:nth-child(odd) {
      background: #f9fafb;
    }

    .question-text {
      font-size: 0.9rem;
      margin-bottom: 0.35rem;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.9rem;
      font-size: 0.85rem;
    }

    .options label {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      color: #374151;
    }

    .followup {
      margin-top: 0.4rem;
      padding-top: 0.4rem;
      border-top: 1px dashed #e5e7eb;
      display: none;
    }

    .followup-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .footer-note {
      margin-top: 0.9rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .actions {
      margin-top: 1.1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.4rem;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-muted);
      border: 1px dashed #d1d5db;
    }

    .status {
      font-size: 0.85rem;
    }

    .status.success {
      color: var(--success);
    }

    .status.error {
      color: var(--danger);
    }

    .question.error-state {
      border-color: rgba(248, 113, 113, 0.9);
      background: #fef2f2;
    }

    .error-inline {
      margin-top: 0.25rem;
      font-size: 0.8rem;
      color: var(--danger);
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="container">
      <header>
        <div class="eyebrow">Humberside Scouts</div>
        <h1>Section Safety Audit</h1>
        <p class="subtitle">
          Complete this audit to confirm that your section meetings, activities and visits are being delivered safely and in line with current expectations.
        </p>
        <div class="tag-row">
          <span class="tag">Section safety</span>
          <span class="tag">Leaders in charge</span>
          <span class="tag">Meetings & activities</span>
        </div>
      </header>

      <div class="note">
        <strong>Branching logic:</strong> Each question is answered with <em>Yes</em>, <em>No</em> or <em>Partially</em>.
        If you select <em>No</em> or <em>Partially</em> you must enter a short explanation and a date by which you expect
        the issue to be fully resolved (brought up to <em>Yes</em>). The audit cannot be submitted until every question is answered.
      </div>

      <form id="auditForm" novalidate>
        <!-- SECTION 1: Basic details -->
        <section class="section-card">
          <div class="section-header">
            <div class="section-title">Section 1 — Basic Details</div>
            <div class="section-pill">About you & your section</div>
          </div>

          <div class="grid-2">
            <div>
              <label>
                Name <span class="required">*</span>
                <input type="text" name="name" autocomplete="name" required />
              </label>
            </div>
            <div>
              <label>
                Email address <span class="required">*</span>
                <input type="email" name="email" autocomplete="email" required />
              </label>
            </div>
          </div>

          <div class="grid-2" style="margin-top:0.75rem;">
            <div>
              <label>
                District <span class="required">*</span>
                <select name="district" required>
                  <option value="">-- Please select --</option>
                  <option>Beverley and Hornsea</option>
                  <option>Blacktoft Beacon</option>
                  <option>City of Hull</option>
                  <option>Grimsby and Cleethorpes</option>
                  <option>North Lincolnshire</option>
                  <option>South Holderness</option>
                  <option>Wolds and Coast</option>
                </select>
              </label>
            </div>
            <div>
              <label>
                Group <span class="required">*</span>
                <input type="text" name="group" required />
              </label>
            </div>
          </div>

          <div style="margin-top:0.75rem;">
            <label>
              Section <span class="required">*</span>
              <input type="text" name="section" placeholder="e.g. 1st Anytown Cubs" required />
            </label>
          </div>
        </section>

        <!-- Section shells for questions -->
        <section class="section-card" id="section2">
          <div class="section-header">
            <div class="section-title">Section 2 — Section Meetings, Games, Activities and Visits</div>
            <div class="section-pill">Operational safety</div>
          </div>
          <div class="section-body"></div>
        </section>

        <section class="section-card" id="section3">
          <div class="section-header">
            <div class="section-title">Section 3 — Leader in Charge</div>
            <div class="section-pill">Leadership & roles</div>
          </div>
          <div class="section-body"></div>
        </section>

        <section class="section-card" id="section4">
          <div class="section-header">
            <div class="section-title">Section 4 — Safety Always on the Agenda</div>
            <div class="section-pill">Culture & follow-up</div>
          </div>
          <div class="section-body"></div>
        </section>

        <p class="footer-note">
          By submitting, you confirm that the information recorded is accurate to the best of your knowledge at the time of completion.
        </p>

        <div class="actions">
          <button type="submit" class="btn btn-primary" id="submitBtn">
            Submit audit
          </button>
          <span class="status" id="status" aria-live="polite"></span>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ---------- CONFIG: Questions ----------
    const questionSections = {
      section2: [
        "All leaders and adult helpers regularly attending section meetings have undertaken the appropriate enquiries (DBS/AAC/Welcome Conversations).",
        "There is a suitable supervision plan in place for all section meetings and visits, including free time and unstructured activities.",
        "There is an appropriate InTouch process in place for all section meetings and visits.",
        "All medical and health details are available for all people at section meetings and visits (including adults).",
        "Chairs and tables are stored safely in the meeting place when not in use.",
        "Tripping or slipping hazards have been reduced, as far as possible, in the meeting place.",
        "Consideration is given to overhead hazards and unguarded lights during all activities.",
        "Boundaries and limits are briefed and understood by all young people whilst at section meetings and on visits.",
        "The potential for falls on solid or sharp objects and glass has been minimised as far as possible.",
        "All games played are suitable for the age and ability of participants.",
        "The rules of all games played are briefed and understood by all participants and leaders.",
        "All equipment used by the section is checked, safe and in good order.",
        "There is a first-aid kit available and accessible at all times for all meetings, activities and visits.",
        "There is a plan for what to do in an emergency during all section meetings and visits."
      ],
      section3: [
        "There is an identified leader in charge for all meetings, events or activities.",
        "The leader in charge ensures that all adults and young people are accounted for regularly.",
        "The leader in charge allocates roles to specific adults and ensures they are aware of their specific responsibilities."
      ],
      section4: [
        "Everyone understands how and when to record and report incidents and accidents.",
        "Safety is discussed at the start of all events and activities, at camp-planning meetings and reviews.",
        "Young people and adults are given appropriate training, guidance and rules appropriate to the activity or event.",
        "The section leadership team is supported to gain training and improve their knowledge of safety.",
        "All safety equipment in the meeting place is inspected regularly."
      ]
    };

    function createQuestionElement(id, text) {
      const wrapper = document.createElement("div");
      wrapper.className = "question";
      wrapper.dataset.questionId = id;

      const textDiv = document.createElement("div");
      textDiv.className = "question-text";
      textDiv.innerHTML = text + ' <span class="required">*</span>';
      wrapper.appendChild(textDiv);

      const optionsDiv = document.createElement("div");
      optionsDiv.className = "options";

      const choices = ["Yes", "No", "Partially"];
      choices.forEach(choice => {
        const choiceId = id + "_" + choice.toLowerCase();
        const radioLabel = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = id;
        radio.value = choice.toLowerCase();
        radio.id = choiceId;
        radio.required = true;
        radioLabel.appendChild(radio);
        radioLabel.appendChild(document.createTextNode(choice));
        optionsDiv.appendChild(radioLabel);
      });

      wrapper.appendChild(optionsDiv);

      const followUpDiv = document.createElement("div");
      followUpDiv.className = "followup";
      followUpDiv.innerHTML = `
        <div class="followup-text">
          Please explain why this is <strong>No</strong> or <strong>Partially</strong>, and give a date by which you expect it to be fully resolved (brought up to “Yes”).
        </div>
        <textarea name="${id}_reason" placeholder="Reason and planned resolution date..."></textarea>
      `;
      wrapper.appendChild(followUpDiv);

      const errorDiv = document.createElement("div");
      errorDiv.className = "error-inline";
      errorDiv.style.display = "none";
      wrapper.appendChild(errorDiv);

      return wrapper;
    }

    function renderQuestions() {
      Object.entries(questionSections).forEach(([sectionId, questions]) => {
        const sectionEl = document.querySelector(`#${sectionId} .section-body`);
        questions.forEach((qText, index) => {
          const qId = sectionId + "_q" + (index + 1);
          const el = createQuestionElement(qId, qText);
          sectionEl.appendChild(el);
        });
      });
    }

    function setupBranching() {
      document.getElementById("auditForm").addEventListener("change", (e) => {
        if (e.target.type === "radio") {
          const name = e.target.name;
          const questionDiv = document.querySelector('.question[data-question-id="' + name + '"]');
          if (!questionDiv) return;
          const followUp = questionDiv.querySelector(".followup");
          const textarea = followUp.querySelector("textarea");
          const errorDiv = questionDiv.querySelector(".error-inline");
          questionDiv.classList.remove("error-state");
          errorDiv.style.display = "none";

          if (e.target.value === "no" || e.target.value === "partially") {
            followUp.style.display = "block";
            textarea.required = true;
          } else {
            followUp.style.display = "none";
            textarea.required = false;
            textarea.value = "";
          }
        }
      });
    }

    function validateAllQuestions() {
      const questions = document.querySelectorAll(".question");
      let firstProblem = null;

      questions.forEach(q => {
        q.classList.remove("error-state");
        const errorDiv = q.querySelector(".error-inline");
        errorDiv.style.display = "none";
        errorDiv.textContent = "";

        const radios = q.querySelectorAll('input[type="radio"]');
        const selected = Array.from(radios).find(r => r.checked);

        if (!selected) {
          if (!firstProblem) firstProblem = q;
          q.classList.add("error-state");
          errorDiv.style.display = "block";
          errorDiv.textContent = "Please select Yes, No or Partially.";
          return;
        }

        if (selected.value === "no" || selected.value === "partially") {
          const textarea = q.querySelector("textarea");
          if (!textarea.value.trim()) {
            if (!firstProblem) firstProblem = q;
            q.classList.add("error-state");
            errorDiv.style.display = "block";
            errorDiv.textContent = "Please add a brief explanation and planned resolution date.";
          }
        }
      });

      return firstProblem;
    }

    async function handleSubmit(event) {
      event.preventDefault();
      const form = event.target;
      const statusEl = document.getElementById("status");
      const submitBtn = document.getElementById("submitBtn");

      statusEl.textContent = "";
      statusEl.className = "status";

      // Basic HTML5 validation for text / email / selects
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Strong explicit validation for every question
      const firstProblem = validateAllQuestions();
      if (firstProblem) {
        statusEl.textContent = "Please answer every question and complete all required explanation boxes.";
        statusEl.classList.add("error");
        firstProblem.scrollIntoView({ behavior: "smooth", block: "center" });
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting…";

      const formData = new FormData(form);
      const payload = {};

      formData.forEach((value, key) => {
        payload[key] = value;
      });

      payload.submittedAt = new Date().toISOString();

      try {
        const response = await fetch("YOUR_FLOW_URL_HERE", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error("Non-200 response");

        statusEl.textContent = "Submitted successfully. Thank you.";
        statusEl.classList.add("success");
        form.reset();

        // Reset follow-up visibility and error states
        document.querySelectorAll(".followup").forEach(div => {
          div.style.display = "none";
        });
        document.querySelectorAll(".question").forEach(q => {
          q.classList.remove("error-state");
          const errorDiv = q.querySelector(".error-inline");
          errorDiv.style.display = "none";
          errorDiv.textContent = "";
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = "There was a problem submitting the audit. Please try again or contact the administrator.";
        statusEl.classList.add("error");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit audit";
      }
    }

    // Init
    renderQuestions();
    setupBranching();
    document.getElementById("auditForm").addEventListener("submit", handleSubmit);
  </script>
</body>
</html>
