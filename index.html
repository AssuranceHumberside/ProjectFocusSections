<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Humberside Scouts – Safety Audit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: #f5f5f5;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.5rem 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    h1, h2 {
      color: #333;
    }
    fieldset {
      border: 1px solid #ddd;
      padding: 1rem 1.2rem;
      margin-bottom: 1.2rem;
      border-radius: 6px;
    }
    legend {
      font-weight: 600;
      padding: 0 0.3rem;
    }
    .question {
      margin: 0.8rem 0;
    }
    .options {
      margin-top: 0.3rem;
    }
    .options label {
      margin-right: 1rem;
    }
    .followup {
      margin-top: 0.4rem;
      display: none;
    }
    textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
    }
    label span.required {
      color: #c00;
      margin-left: 0.2rem;
    }
    .note {
      font-size: 0.9rem;
      color: #555;
      background: #f0f7ff;
      border-left: 4px solid #1d4ed8;
      padding: 0.8rem 1rem;
      margin-bottom: 1rem;
      border-radius: 4px;
    }
    .btn {
      display: inline-block;
      background: #2563eb;
      color: #fff;
      padding: 0.6rem 1.4rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .status {
      margin-top: 1rem;
      font-size: 0.95rem;
    }
    .status.success {
      color: #166534;
    }
    .status.error {
      color: #b91c1c;
    }
    .small {
      font-size: 0.85rem;
      color: #666;
    }
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    @media (max-width: 700px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Humberside Scouts – Safety Audit</h1>
    <p class="note">
      <strong>Branching logic:</strong> Each question is answered with <em>Yes</em>, <em>No</em>,
      or <em>Partially</em>. If you choose <em>No</em> or <em>Partially</em>, you must enter a
      free-text explanation and a date by which you expect the issue to be fully resolved
      (i.e. brought up to <em>Yes</em>).
    </p>

    <form id="auditForm">
      <!-- SECTION 1: Basic details -->
      <fieldset>
        <legend>Section 1 — Basic Details</legend>

        <div class="two-col">
          <div>
            <label>
              Name <span class="required">*</span><br />
              <input type="text" name="name" required />
            </label>
          </div>
          <div>
            <label>
              Email address <span class="required">*</span><br />
              <input type="email" name="email" required />
            </label>
          </div>
        </div>

        <div class="two-col" style="margin-top:0.8rem;">
          <div>
            <label>
              District <span class="required">*</span><br />
              <select name="district" required>
                <option value="">-- Please select --</option>
                <option>Beverley and Hornsea</option>
                <option>Blacktoft Beacon</option>
                <option>City of Hull</option>
                <option>Grimsby and Cleethorpes</option>
                <option>North Lincolnshire</option>
                <option>South Holderness</option>
                <option>Wolds and Coast</option>
              </select>
            </label>
          </div>
          <div>
            <label>
              Group <span class="required">*</span><br />
              <input type="text" name="group" required />
            </label>
          </div>
        </div>

        <div style="margin-top:0.8rem;">
          <label>
            Section <span class="required">*</span><br />
            <input type="text" name="section" required />
          </label>
        </div>
      </fieldset>

      <!-- Helper component: question block -->
      <!-- We will generate this via JS from a config array -->

      <fieldset id="section2">
        <legend>Section 2 — Section Meetings, Games, Activities and Visits</legend>
        <!-- Questions injected here by JS -->
      </fieldset>

      <fieldset id="section3">
        <legend>Section 3 — Leader in Charge</legend>
        <!-- Questions injected here by JS -->
      </fieldset>

      <fieldset id="section4">
        <legend>Section 4 — Safety Always on the Agenda</legend>
        <!-- Questions injected here by JS -->
      </fieldset>

      <p class="small">
        By submitting, you confirm that the information recorded is accurate to the best of your knowledge.
      </p>

      <button type="submit" class="btn" id="submitBtn">Submit audit</button>
      <div id="status" class="status" aria-live="polite"></div>
    </form>
  </div>

  <script>
    // === CONFIG: list of questions ==========================
    const questionSections = {
      section2: [
        "All leaders and adult helpers regularly attending section meetings have undertaken the appropriate enquiries (DBS/AAC/Welcome Conversations).",
        "There is a suitable supervision plan in place for all section meetings and visits, including free time and unstructured activities.",
        "There is an appropriate InTouch process in place for all section meetings and visits.",
        "All medical and health details are available for all people at section meetings and visits (including adults).",
        "Chairs and tables are stored safely in the meeting place when not in use.",
        "Tripping or slipping hazards have been reduced, as far as possible, in the meeting place.",
        "Consideration is given to overhead hazards and unguarded lights during all activities.",
        "Boundaries and limits are briefed and understood by all young people whilst at section meetings and on visits.",
        "The potential for falls on solid or sharp objects and glass has been minimised as far as possible.",
        "All games played are suitable for the age and ability of participants.",
        "The rules of all games played are briefed and understood by all participants and leaders.",
        "All equipment used by the section is checked, safe and in good order.",
        "There is a first-aid kit available and accessible at all times for all meetings, activities and visits.",
        "There is a plan for what to do in an emergency during all section meetings and visits."
      ],
      section3: [
        "There is an identified leader in charge for all meetings, events or activities.",
        "The leader in charge ensures that all adults and young people are accounted for regularly.",
        "The leader in charge allocates roles to specific adults and ensures they are aware of their specific responsibilities."
      ],
      section4: [
        "Everyone understands how and when to record and report incidents and accidents.",
        "Safety is discussed at the start of all events and activities, at camp-planning meetings and reviews.",
        "Young people and adults are given appropriate training, guidance and rules appropriate to the activity or event.",
        "The section leadership team is supported to gain training and improve their knowledge of safety.",
        "All safety equipment in the meeting place is inspected regularly."
      ]
    };

    function createQuestionElement(id, text) {
      const wrapper = document.createElement("div");
      wrapper.className = "question";
      wrapper.dataset.questionId = id;

      const label = document.createElement("label");
      label.innerHTML = text + ' <span class="required">*</span>';
      wrapper.appendChild(label);

      const optionsDiv = document.createElement("div");
      optionsDiv.className = "options";

      const choices = ["Yes", "No", "Partially"];
      choices.forEach(choice => {
        const choiceId = id + "_" + choice.toLowerCase();
        const radioLabel = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = id;
        radio.value = choice.toLowerCase();
        radio.id = choiceId;
        radio.required = true;
        radioLabel.appendChild(radio);
        radioLabel.appendChild(document.createTextNode(" " + choice));
        optionsDiv.appendChild(radioLabel);
      });

      wrapper.appendChild(optionsDiv);

      const followUpDiv = document.createElement("div");
      followUpDiv.className = "followup";
      followUpDiv.innerHTML = `
        <div class="small">
          Please explain why this is <strong>No</strong> or <strong>Partially</strong>, and give a date by which you expect it to be fully resolved (brought up to “Yes”).
        </div>
        <textarea name="${id}_reason" placeholder="Reason and planned resolution date..."></textarea>
      `;
      wrapper.appendChild(followUpDiv);

      return wrapper;
    }

    function renderQuestions() {
      Object.entries(questionSections).forEach(([sectionId, questions]) => {
        const sectionEl = document.getElementById(sectionId);
        questions.forEach((qText, index) => {
          const qId = sectionId + "_q" + (index + 1);
          const el = createQuestionElement(qId, qText);
          sectionEl.appendChild(el);
        });
      });
    }

    function setupBranching() {
      document.getElementById("auditForm").addEventListener("change", (e) => {
        if (e.target.type === "radio") {
          const name = e.target.name;
          const questionDiv = document.querySelector('.question[data-question-id="' + name + '"]');
          if (!questionDiv) return;
          const followUp = questionDiv.querySelector(".followup");
          if (!followUp) return;

          if (e.target.value === "no" || e.target.value === "partially") {
            followUp.style.display = "block";
            followUp.querySelector("textarea").required = true;
          } else {
            followUp.style.display = "none";
            followUp.querySelector("textarea").required = false;
            followUp.querySelector("textarea").value = "";
          }
        }
      });
    }

    async function handleSubmit(event) {
      event.preventDefault();
      const form = event.target;
      const statusEl = document.getElementById("status");
      const submitBtn = document.getElementById("submitBtn");

      statusEl.textContent = "";
      statusEl.className = "status";

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";

      const formData = new FormData(form);
      const payload = {};

      formData.forEach((value, key) => {
        payload[key] = value;
      });

      // Add a timestamp client-side
      payload.submittedAt = new Date().toISOString();

      try {
        const response = await fetch("YOUR_FLOW_URL_HERE", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error("Non-200 response");
        }

        statusEl.textContent = "Submitted successfully. Thank you.";
        statusEl.classList.add("success");
        form.reset();

        // Hide any follow-up boxes that might still be visible
        document.querySelectorAll(".followup").forEach(div => {
          div.style.display = "none";
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = "There was a problem submitting the audit. Please try again or contact the administrator.";
        statusEl.classList.add("error");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit audit";
      }
    }

    // Initialise
    renderQuestions();
    setupBranching();
    document.getElementById("auditForm").addEventListener("submit", handleSubmit);
  </script>
</body>
</html>
